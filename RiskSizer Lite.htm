<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RiskSizer â€” Lite Sizing Calculator</title>
<style>
  :root{
    --accent:#ed7d31; --bg:#f7f7f7; --paper:#fff; --ink:#111; --muted:#666; --ring:rgba(237,125,49,.25);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;color:var(--ink);background:linear-gradient(135deg,#fff 0%,var(--bg) 100%)}
  .wrap{max-width:1100px;margin:24px auto 64px;padding:0 20px}
  .card{background:var(--paper);border:1px solid #eee;border-radius:20px;box-shadow:0 12px 40px rgba(0,0,0,.06);padding:28px}
  h1{font-size:28px;margin:0 0 8px}
  .sub{color:var(--muted);margin-bottom:16px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .box, .box4, .box6 { position: relative; }
  .box{grid-column:span 12;}
  @media(min-width:900px){ .box6{grid-column:span 6} .box4{grid-column:span 4} .box8{grid-column:span 8} }
  label{display:block;font-size:13px;font-weight:600;margin:6px 0}
  input[type="number"],select{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;font-size:15px}
  input:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:12px; min-height: 28px;}
  .muted{color:var(--muted);font-size:13px}
  .section{margin-top:16px;padding-top:12px;border-top:2px solid #faf0e7}
  .msg{padding:8px 10px;border-radius:10px;font-size:13px;display:none;margin-top:4px;}
  .warn{background:#fff4f0;border:1px solid #ffd6c5;color:#a9481b;}
  .ok{background:#ecfff1;border:1px solid #c8f0d3;color:#0a6b2d;}
  .error{background:#ffebee;border:1px solid #ffcdd2;color:#c62828;}
  .out{background:#fafafa;border:1px dashed #ddd;border-radius:12px;padding:16px}
  .out h3{margin:0 0 8px;font-size:16px;color:var(--accent)}
  .stat{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  .stat div{background:#fff;border:1px solid #eee;border-radius:10px;padding:10px 12px}
  .stat b{display:block;font-size:18px}
  .btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:20px}
  button{appearance:none;border:0;border-radius:10px;padding:12px 18px;font-weight:700;cursor:pointer;font-size: 15px;}
  .primary{background:var(--accent);color:#fff}
  .secondary{background:#eee}
  .foot{margin-top:10px;color:#777;font-size:12px}
  .note{font-size:12px;color:#555}
  .market-specific{display:none;}
  .hint-box{display:none;position:absolute;top:100%;left:0;width:100%;z-index:10;background:#fff9f5;border:1px solid #ffe8d9;padding:12px 16px;margin-top:4px;border-radius:10px;font-size:13px;line-height:1.6;color:#555;padding-right:30px;}
  .hint-box a{color:var(--accent);font-weight:600;text-decoration:none;}
  .hint-box a:hover{text-decoration:underline;}
  .close-hint{position:absolute;top:8px;right:10px;font-size:20px;color:#aaa;cursor:pointer;font-family:sans-serif;}
  .close-hint:hover{color:#333;}
  .disabled-feature{opacity:0.6;background:#f9f9f9; cursor: not-allowed;}
  .disabled-label{position:relative;cursor:not-allowed;}
  .disabled-label .lock{display:inline-block;margin-left:4px; font-style: normal;}
  .disabled-label[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 5px 10px;
    border-radius: 6px;
    background: #333;
    color: #fff;
    font-size: 12px;
    white-space: nowrap;
    z-index: 10;
  }
  .upsell{margin-top:28px;padding:20px;background:#fff9f5;border:1px solid #ffe8d9;border-radius:16px;text-align:center}
  .upsell h2{margin:0 0 8px;font-size:18px;color:var(--ink)}
  .upsell p{margin:0 0 16px;color:var(--muted);font-size:14px;line-height:1.6}
  .upsell-btn{display:inline-block;background:var(--accent);color:#fff;border-radius:12px;padding:12px 20px;text-decoration:none;font-weight:700;font-size:15px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>RiskSizer Lite</h1>
    <div class="sub">Calculate your position size with a fixed 1% risk. Unlock advanced features in the full version.</div>
    <div id="error-message" class="msg error"></div>

    <div class="grid">
      <div class="box4">
        <label>Equity USD</label>
        <input type="number" id="equity" placeholder="e.g., 5000">
      </div>
      <div class="box4">
        <label class="disabled-label" data-tooltip="Available in the Full Version">RPT mode <i class="lock">ðŸ”’</i></label>
        <select id="rptMode" disabled class="disabled-feature">
          <option>Fixed</option>
        </select>
      </div>
      <div class="box4">
        <label class="disabled-label" data-tooltip="Available in the Full Version">RPT percent â€” Fixed <i class="lock">ðŸ”’</i></label>
        <input type="number" id="rptFixed" value="1.0" disabled class="disabled-feature">
      </div>
      
      <div class="box4">
        <label>Market</label>
        <select id="market">
          <option selected>Spot / Stocks / Crypto</option>
          <option>Perps / Futures â€” tick</option>
          <option>Forex â€” pips</option>
        </select>
      </div>
      <div class="box4">
        <label>Direction</label>
        <select id="direction">
          <option selected>Long</option>
          <option>Short</option>
        </select>
      </div>
       <div class="box4">&nbsp;</div>

      <div class="box4">
        <label>Entry</label>
        <input type="number" id="entry" placeholder="e.g., 25">
      </div>
      <div class="box4">
        <label>Stop</label>
        <input type="number" id="stop" placeholder="e.g., 23.8">
      </div>
      <div class="box4">
        <label>Target</label>
        <input type="number" id="target" placeholder="e.g., 27.4">
        <div id="target-hint" class="hint-box">
          <em>Assessing a realistic Target Price is key. This skill is covered in the full e-book. <a href="https://risksizer.gumroad.com/l/risk-first" target="_blank">Get the Full Version</a></em>
          <span class="close-hint" id="close-target-hint">&times;</span>
        </div>
      </div>
      
      <div class="box4">
        <label class="disabled-label" data-tooltip="Available in the Full Version">ATR 14 <i class="lock">ðŸ”’</i></label>
        <input type="number" id="atr" placeholder="Pro Feature" disabled class="disabled-feature">
      </div>
      <div class="box4">
        <label class="disabled-label" data-tooltip="Available in the Full Version">k â€” ATR buffer <i class="lock">ðŸ”’</i></label>
        <input type="number" id="k" placeholder="Pro Feature" disabled class="disabled-feature">
      </div>
      <div class="box4">&nbsp;</div>
      
      <div class="box12">
        <div id="perp-fields" class="market-specific">
          <label>Tick value â€” Perps</label>
          <input type="number" id="tickValue" placeholder="1">
          <div class="note">Perps and futures only: USD per 1 tick per 1 contract.</div>
        </div>
      </div>
      
      <div class="box12">
        <div id="forex-fields" class="market-specific">
          <label>FX â€” pip size and USD per 10k</label>
          <div class="grid">
            <div class="box6">
              <input type="number" id="pipSize" placeholder="0.0001">
              <div class="note">Example: 0.01 for JPY pairs.</div>
            </div>
            <div class="box6">
              <input type="number" id="pipVal10k" placeholder="1" disabled class="disabled-feature">
               <div class="note">USD per 10k units (Fixed at 1 in Lite).</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="btns">
        <button class="primary" id="calculate">Calculate</button>
        <button class="secondary" id="reset">Reset</button>
        <button class="secondary disabled-feature" id="copyRow">Copy Journal Row <i class="lock">ðŸ”’</i></button>
    </div>

    <div class="section">
      <div class="row">
        <span class="msg warn" id="warn">Warning: Poor Risk:Reward Ratio (&lt; 1.5).</span>
        <span class="msg ok" id="ok">Good: Risk:Reward is above 1.5.</span>
      </div>

      <div class="grid">
        <div class="box6 out">
          <h3>Key outputs</h3>
          <div class="stat">
            <div><span class="muted">RPT used</span><b id="rptUsed">â€”</b></div>
            <div><span class="muted">R in USD per trade</span><b id="rMoney">â€”</b></div>
            <div><span class="muted">Risk per unit</span><b id="rpu">â€”</b></div>
            <div><span class="muted">Planned R:R</span><b id="rr">â€”</b></div>
          </div>
        </div>
        <div class="box6 out">
          <h3>Position size</h3>
          <div class="stat">
            <div><span class="muted">Size â€” units or contracts</span><b id="size">â€”</b></div>
            <div><span class="muted">Position value approx</span><b id="posVal">â€”</b></div>
            <div><span class="muted disabled-label" data-tooltip="Available in the Full Version">Daily limit <i class="lock">ðŸ”’</i></span><b>â€”</b></div>
            <div><span class="muted disabled-label" data-tooltip="Available in the Full Version">Weekly limit <i class="lock">ðŸ”’</i></span><b>â€”</b></div>
          </div>
          <div class="foot">Limits: 2R per day and 6R per week.</div>
        </div>
      </div>
    </div>
    
    <div class="upsell">
      <h2>You're using the Lite version</h2>
      <p>The full RiskSizer system includes the complete "Risk-First" e-book, an advanced calculator with adaptive RPT based on R:R, daily loss limits, ATR buffers, and much more.</p>
      <a href="https://risksizer.gumroad.com/l/risk-first" class="upsell-btn" target="_blank">Get The Full Version</a>
    </div>

  </div>
</div>

<script>
// --- DOM BINDINGS ---
const DOM = {
    inputs: {
        equity: document.getElementById('equity'),
        market: document.getElementById('market'),
        direction: document.getElementById('direction'),
        entry: document.getElementById('entry'),
        stop: document.getElementById('stop'),
        target: document.getElementById('target'),
        tickValue: document.getElementById('tickValue'),
        pipSize: document.getElementById('pipSize')
    },
    outputs: ['rptUsed','rMoney','rpu','rr','size','posVal'],
    messages: {
        error: document.getElementById('error-message'),
        warn: document.getElementById('warn'),
        ok: document.getElementById('ok'),
        targetHint: document.getElementById('target-hint')
    },
    buttons: {
        calculate: document.getElementById('calculate'),
        reset: document.getElementById('reset'),
        closeHint: document.getElementById('close-target-hint')
    },
    marketSpecific: {
        perp: document.getElementById('perp-fields'),
        forex: document.getElementById('forex-fields')
    }
};

// --- UTILITIES ---
function fmt(n, d=2){ if(!isFinite(n)) return "â€”"; return Number(n).toLocaleString(undefined,{maximumFractionDigits:d, minimumFractionDigits:d}); }

function getNum(el, fallback=0){
    const num = parseFloat(String(el.value).replace(',', '.'));
    return isFinite(num) ? num : fallback;
}


// --- CORE LOGIC ---
function calculateMetrics() {
    const i = {
        equity: getNum(DOM.inputs.equity),
        market: DOM.inputs.market.value,
        direction: DOM.inputs.direction.value,
        entry: getNum(DOM.inputs.entry),
        stop: getNum(DOM.inputs.stop),
        target: getNum(DOM.inputs.target),
        tickValue: getNum(DOM.inputs.tickValue, 1),
        pipSize: getNum(DOM.inputs.pipSize, 0.0001)
    };
    
    const rptUsed = 1.0;
    const results = { error: null, rr: 0 };
    const isLong = i.direction === 'Long';

    // Validation
    if (!i.equity || !i.entry || !i.stop || !i.target) {
        results.error = "Please fill in Equity, Entry, Stop, and Target.";
        return results;
    }
    if (isLong && i.stop >= i.entry) { results.error = "For a Long trade, Stop must be below Entry."; return results; }
    if (!isLong && i.stop <= i.entry) { results.error = "For a Short trade, Stop must be above Entry."; return results; }
    if (isLong && i.target <= i.entry) { results.error = "For a Long trade, Target must be above Entry."; return results; }
    if (!isLong && i.target >= i.entry) { results.error = "For a Short trade, Target must be below Entry."; return results; }

    const stopDist = Math.abs(i.entry - i.stop);
    const targetDist = Math.abs(i.target - i.entry);
    results.rr = stopDist > 0 ? targetDist / stopDist : 0;
    
    results.rptUsed = rptUsed;
    results.R = i.equity * (results.rptUsed / 100.0);

    if (i.market.includes('Spot')) {
        results.riskPerUnit = stopDist;
    } else if (i.market.includes('Perps')) {
        results.riskPerUnit = stopDist * i.tickValue;
    } else { // Forex
        const pipsToStop = i.pipSize > 0 ? stopDist / i.pipSize : 0;
        const pipValPerUnit = 1.0 / 10000.0;
        results.riskPerUnit = pipsToStop * pipValPerUnit;
    }
    
    results.size = 0;
    if (results.riskPerUnit > 0 && results.R > 0) {
        results.size = results.R / results.riskPerUnit;
        if (i.market.includes('Spot')) results.size = Math.floor(results.size);
        else if (i.market.includes('Perps')) results.size = Math.round(results.size * 100) / 100;
        else results.size = Math.floor(results.size / 1000) * 1000;
    }
    
    results.posVal = results.size * i.entry;
    
    return results;
}

function updateUI(results) {
    Object.values(DOM.messages).forEach(el => {if(el.id !== 'target-hint') el.style.display = 'none'});

    if (results.error) {
        DOM.messages.error.textContent = results.error;
        DOM.messages.error.style.display = 'block';
        DOM.outputs.forEach(id => { document.getElementById(id).textContent = "â€”"; });
        return;
    }
    
    document.getElementById('rptUsed').textContent = fmt(results.rptUsed, 1) + ' %';
    document.getElementById('rMoney').textContent  = '$ ' + fmt(results.R, 2);
    document.getElementById('rpu').textContent     = '$ ' + fmt(results.riskPerUnit, 4);
    document.getElementById('rr').textContent      = fmt(results.rr, 2) + ' R:R';
    document.getElementById('size').textContent    = fmt(results.size, DOM.inputs.market.value.includes('Perps') ? 2 : 0);
    document.getElementById('posVal').textContent  = '$ ' + fmt(results.posVal, 2);
    
    if (results.rr < 1.5) {
        DOM.messages.warn.style.display = 'inline-block';
    } else {
        DOM.messages.ok.style.display = 'inline-block';
    }
}

function resetAll() {
    Object.values(DOM.inputs).forEach(el => el.value = "");
    DOM.inputs.market.value = 'Spot / Stocks / Crypto';
    DOM.inputs.direction.value = 'Long';
    
    DOM.outputs.forEach(id => { document.getElementById(id).textContent = 'â€”'; });
    Object.values(DOM.messages).forEach(el => {if(el.id !== 'target-hint') el.style.display = 'none'});
    
    toggleMarketFields();
}

function toggleMarketFields() {
    const market = DOM.inputs.market.value;
    DOM.marketSpecific.perp.style.display = market.includes('Perps') ? 'block' : 'none';
    DOM.marketSpecific.forex.style.display = market.includes('Forex') ? 'block' : 'none';
}


// --- EVENT LISTENERS ---
DOM.buttons.calculate.addEventListener('click', () => {
    const results = calculateMetrics();
    updateUI(results);
});

DOM.buttons.reset.addEventListener('click', resetAll);
DOM.inputs.market.addEventListener('change', toggleMarketFields);
DOM.inputs.target.addEventListener('focus', () => {
    if (sessionStorage.getItem('targetHintClosed') !== 'true') {
        DOM.messages.targetHint.style.display = 'block';
    }
});
DOM.buttons.closeHint.addEventListener('click', () => {
    DOM.messages.targetHint.style.display = 'none';
    sessionStorage.setItem('targetHintClosed', 'true');
});


// --- INITIAL STATE ---
document.addEventListener('DOMContentLoaded', () => {
    toggleMarketFields();
    resetAll();
});
</script>
</body>
</html>